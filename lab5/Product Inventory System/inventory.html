<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced Inventory System</title>
    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --warning: #f59e0b; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; padding: 20px; color: var(--primary); }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        
        /* Dashboard Stats */
        .stats-bar { display: flex; justify-content: space-between; background: var(--primary); color: white; padding: 15px 25px; border-radius: 8px; margin-bottom: 25px; }
        
        /* Form & Search */
        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 25px; background: #f1f5f9; padding: 20px; border-radius: 8px; }
        input, select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; }
        
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: white; transition: 0.2s; }
        .btn-add { background: var(--accent); }
        .btn-save { background: #10b981; display: none; }

        /* Table & Low Stock Warning */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #f8fafc; }
        .low-stock { background: #fff7ed; color: #c2410c; font-weight: bold; }
        .low-stock-badge { background: var(--warning); color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; }

        .error-msg { color: var(--danger); font-size: 0.85rem; margin-top: 5px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>üì¶ Product Inventory Manager</h2>
    
    <div class="stats-bar">
        <span>Total Items: <b id="totalItems">0</b></span>
        <span>Total Inventory Value: <b id="totalValue">$0.00</b></span>
    </div>

    <div class="controls">
        <input type="text" id="pId" placeholder="ID (P001)">
        <input type="text" id="pName" placeholder="Product Name">
        <input type="text" id="pCat" placeholder="Category">
        <input type="number" id="pPrice" placeholder="Price">
        <input type="number" id="pStock" placeholder="Stock">
        <button onclick="addProduct()" id="addBtn" class="btn btn-add">Add Product</button>
        <button onclick="saveEdit()" id="saveBtn" class="btn btn-save">Save Edit</button>
        
        <div style="grid-column: 1 / -1; margin-top: 10px;">
            <input type="text" id="searchBox" placeholder="Search by Category..." oninput="searchByCategory()" style="width: 100%">
        </div>
    </div>

    <div id="formError" class="error-msg">‚ö†Ô∏è Please fill all fields correctly.</div>

    <table id="inventoryTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let inventory = [];

    // 1. READ: Load Data (Fetch + LocalStorage Fallback)
    window.onload = async () => {
        const localData = localStorage.getItem('myInventory');
        if (localData) {
            inventory = JSON.parse(localData);
            renderInventory();
        } else {
            try {
                const response = await fetch('inventory.json');
                if (!response.ok) throw new Error("File not found");
                inventory = await response.json();
                syncData();
            } catch (err) {
                console.error("Fetch error:", err);
            }
        }
    };

    // 2. CREATE: Add Product
    function addProduct() {
        const id = document.getElementById('pId').value.trim();
        const name = document.getElementById('pName').value.trim();
        const cat = document.getElementById('pCat').value.trim();
        const price = parseFloat(document.getElementById('pPrice').value);
        const stock = parseInt(document.getElementById('pStock').value);

        if (!id || !name || isNaN(price) || isNaN(stock)) {
            document.getElementById('formError').style.display = 'block';
            return;
        }

        inventory.push({ id, name, category: cat, price, stock });
        syncData();
        clearForm();
    }

    // 3. SEARCH: By Category
    function searchByCategory() {
        const query = document.getElementById('searchBox').value.toLowerCase();
        const filtered = inventory.filter(p => p.category.toLowerCase().includes(query));
        renderInventory(filtered);
    }

    // 4. UPDATE: Load for Edit
    function editProduct(id) {
        const p = inventory.find(item => item.id === id);
        document.getElementById('pId').value = p.id;
        document.getElementById('pId').disabled = true;
        document.getElementById('pName').value = p.name;
        document.getElementById('pCat').value = p.category;
        document.getElementById('pPrice').value = p.price;
        document.getElementById('pStock').value = p.stock;

        document.getElementById('addBtn').style.display = 'none';
        document.getElementById('saveBtn').style.display = 'inline-block';
    }

    function saveEdit() {
        const id = document.getElementById('pId').value;
        const index = inventory.findIndex(p => p.id === id);
        
        inventory[index].price = parseFloat(document.getElementById('pPrice').value);
        inventory[index].stock = parseInt(document.getElementById('pStock').value);
        inventory[index].name = document.getElementById('pName').value;
        inventory[index].category = document.getElementById('pCat').value;

        syncData();
        clearForm();
    }

    // 5. DELETE: Remove Product
    function deleteProduct(id) {
        if(confirm("Remove this product?")) {
            inventory = inventory.filter(p => p.id !== id);
            syncData();
        }
    }

    // --- UTILITIES ---

    function renderInventory(data = inventory) {
        const body = document.getElementById('tableBody');
        body.innerHTML = "";
        let totalValue = 0;

        data.forEach(p => {
            const isLow = p.stock < 5;
            totalValue += (p.price * p.stock);
            
            body.innerHTML += `
                <tr class="${isLow ? 'low-stock' : ''}">
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>${p.category}</td>
                    <td>$${p.price.toFixed(2)}</td>
                    <td>
                        ${p.stock} 
                        ${isLow ? '<span class="low-badge">LOW</span>' : ''}
                    </td>
                    <td>
                        <button onclick="editProduct('${p.id}')" style="color:var(--accent); background:none; border:none; cursor:pointer">Edit</button> | 
                        <button onclick="deleteProduct('${p.id}')" style="color:var(--danger); background:none; border:none; cursor:pointer">Delete</button>
                    </td>
                </tr>`;
        });

        document.getElementById('totalItems').textContent = data.length;
        document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
    }

    function syncData() {
        localStorage.setItem('myInventory', JSON.stringify(inventory));
        renderInventory();
    }

    function clearForm() {
        document.getElementById('pId').disabled = false;
        document.querySelectorAll('.controls input').forEach(i => i.value = "");
        document.getElementById('addBtn').style.display = 'inline-block';
        document.getElementById('saveBtn').style.display = 'none';
        document.getElementById('formError').style.display = 'none';
    }
</script>
</body>
</html>