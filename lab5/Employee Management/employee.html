<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System (XML + Persistence)</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: #f8fafc; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 15px rgba(0,0,0,0.05); }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; background: #f1f5f9; padding: 20px; border-radius: 8px; }
        input { padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; }
        .btn-update { background: var(--success); color: white; display: none; }
        .btn-reset { background: var(--secondary); color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        th { background: #1e293b; color: white; }
        tr:hover { background: #f1f5f9; }

        .status { padding: 12px; border-radius: 6px; margin-bottom: 15px; display: none; animation: fadeIn 0.3s; }
        .success { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
        .error { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h2>Employee Management (XML Engine)</h2>
    <div id="status" class="status"></div>

    <div class="form-grid">
        <input type="text" id="empId" placeholder="Employee ID (e.g. E001)">
        <input type="text" id="empName" placeholder="Full Name">
        <input type="text" id="empDept" placeholder="Department">
        <input type="number" id="empSalary" placeholder="Salary">
        <div class="btn-group">
            <button onclick="addEmployee()" class="btn-add" id="addBtn">Add Employee</button>
            <button onclick="saveUpdate()" class="btn-update" id="updateBtn">Save Update</button>
            <button onclick="resetForm()" class="btn-reset">Reset</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Department</th>
                <th>Salary</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let xmlDoc = null;

    // 1. READ: Initialize Data
    window.onload = function() {
        const savedData = localStorage.getItem('employeeXML');
        
        if (savedData) {
            // Load from LocalStorage if user has already made changes
            const parser = new DOMParser();
            xmlDoc = parser.parseFromString(savedData, "text/xml");
            renderTable();
        } else {
            // Otherwise, try to fetch the initial XML file via AJAX
            fetchInitialXML();
        }
    };

    function fetchInitialXML() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "employees.xml", true);
        xhr.onload = function() {
            if (xhr.status === 200) {
                xmlDoc = xhr.responseXML;
                renderTable();
            } else {
                // If file access is blocked (CORS), create an empty XML structure
                createNewXML();
                showStatus("Local file blocked or missing. Started fresh XML session.", "error");
            }
        };
        xhr.onerror = () => createNewXML();
        xhr.send();
    }

    function createNewXML() {
        const parser = new DOMParser();
        xmlDoc = parser.parseFromString("<employees></employees>", "text/xml");
        renderTable();
    }

    // 2. CREATE: Add Node
    function addEmployee() {
        const id = document.getElementById('empId').value.trim();
        const name = document.getElementById('empName').value.trim();
        const dept = document.getElementById('empDept').value.trim();
        const sal = document.getElementById('empSalary').value.trim();

        if (!id || !name || !dept || !sal) return showStatus("Fill all fields!", "error");

        // Check for duplicate ID
        if (findEmployeeNode(id)) return showStatus("ID already exists!", "error");

        const newEmp = xmlDoc.createElement("employee");
        newEmp.innerHTML = `<id>${id}</id><name>${name}</name><dept>${dept}</dept><salary>${sal}</salary>`;
        
        xmlDoc.documentElement.appendChild(newEmp);
        saveAndSync("Employee added!");
    }

    // 3. DELETE: Remove Node
    function deleteEmployee(id) {
        const node = findEmployeeNode(id);
        if (node && confirm("Delete record?")) {
            node.remove();
            saveAndSync("Record deleted.");
        }
    }

    // 4. UPDATE: Edit Logic
    function editEmployee(id) {
        const node = findEmployeeNode(id);
        document.getElementById('empId').value = node.querySelector('id').textContent;
        document.getElementById('empId').disabled = true;
        document.getElementById('empName').value = node.querySelector('name').textContent;
        document.getElementById('empDept').value = node.querySelector('dept').textContent;
        document.getElementById('empSalary').value = node.querySelector('salary').textContent;

        document.getElementById('addBtn').style.display = 'none';
        document.getElementById('updateBtn').style.display = 'inline-block';
    }

    function saveUpdate() {
        const id = document.getElementById('empId').value;
        const node = findEmployeeNode(id);
        
        node.querySelector('name').textContent = document.getElementById('empName').value;
        node.querySelector('dept').textContent = document.getElementById('empDept').value;
        node.querySelector('salary').textContent = document.getElementById('empSalary').value;

        saveAndSync("Update successful!");
        resetForm();
    }

    // --- Utilities ---

    function findEmployeeNode(id) {
        const emps = xmlDoc.getElementsByTagName("employee");
        for (let emp of emps) {
            if (emp.querySelector('id').textContent === id) return emp;
        }
        return null;
    }

    function saveAndSync(msg) {
        const serializer = new XMLSerializer();
        const xmlString = serializer.serializeToString(xmlDoc);
        localStorage.setItem('employeeXML', xmlString);
        renderTable();
        showStatus(msg, "success");
    }

    function renderTable() {
        const body = document.getElementById('tableBody');
        body.innerHTML = "";
        const emps = xmlDoc.getElementsByTagName("employee");

        for (let emp of emps) {
            const id = emp.querySelector('id').textContent;
            body.innerHTML += `
                <tr>
                    <td>${id}</td>
                    <td>${emp.querySelector('name').textContent}</td>
                    <td>${emp.querySelector('dept').textContent}</td>
                    <td>$${emp.querySelector('salary').textContent}</td>
                    <td>
                        <button onclick="editEmployee('${id}')" style="color:var(--primary)">Edit</button>
                        <button onclick="deleteEmployee('${id}')" style="color:var(--danger)">Delete</button>
                    </td>
                </tr>`;
        }
    }

    function showStatus(text, type) {
        const s = document.getElementById('status');
        s.textContent = text;
        s.className = `status ${type}`;
        s.style.display = 'block';
        setTimeout(() => s.style.display = 'none', 3000);
    }

    function resetForm() {
        document.getElementById('empId').disabled = false;
        document.getElementById('empId').value = "";
        document.getElementById('empName').value = "";
        document.getElementById('empDept').value = "";
        document.getElementById('empSalary').value = "";
        document.getElementById('addBtn').style.display = 'inline-block';
        document.getElementById('updateBtn').style.display = 'none';
    }
</script>
</body>
</html>